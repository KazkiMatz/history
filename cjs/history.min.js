"use strict";function _interopDefault(n){return n&&"object"==typeof n&&"default"in n?n.default:n}Object.defineProperty(exports,"__esModule",{value:!0});var resolvePathname=_interopDefault(require("resolve-pathname")),valueEqual=_interopDefault(require("value-equal"));require("tiny-warning");var invariant=_interopDefault(require("tiny-invariant"));function _extends(){return(_extends=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e,a=arguments[t];for(e in a)Object.prototype.hasOwnProperty.call(a,e)&&(n[e]=a[e])}return n}).apply(this,arguments)}function addLeadingSlash(n){return"/"===n.charAt(0)?n:"/"+n}function stripLeadingSlash(n){return"/"===n.charAt(0)?n.substr(1):n}function hasBasename(n,t){return new RegExp("^"+t+"(\\/|\\?|#|$)","i").test(n)}function stripBasename(n,t){return hasBasename(n,t)?n.substr(t.length):n}function stripTrailingSlash(n){return"/"===n.charAt(n.length-1)?n.slice(0,-1):n}function parsePath(n){var t=n||"/",e="",a="",n=t.indexOf("#");-1!==n&&(a=t.substr(n),t=t.substr(0,n));n=t.indexOf("?");return-1!==n&&(e=t.substr(n),t=t.substr(0,n)),{pathname:t,search:"?"===e?"":e,hash:"#"===a?"":a}}function createPath(n){var t=n.pathname,e=n.search,n=n.hash,t=t||"/";return e&&"?"!==e&&(t+="?"===e.charAt(0)?e:"?"+e),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function createLocation(n,t,e,a){var o;"string"==typeof n?(o=parsePath(n)).state=t:(void 0===(o=_extends({},n)).pathname&&(o.pathname=""),o.search?"?"!==o.search.charAt(0)&&(o.search="?"+o.search):o.search="",o.hash?"#"!==o.hash.charAt(0)&&(o.hash="#"+o.hash):o.hash="",void 0!==t&&void 0===o.state&&(o.state=t));try{o.pathname=decodeURI(o.pathname)}catch(n){throw n instanceof URIError?new URIError('Pathname "'+o.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):n}return e&&(o.key=e),a?o.pathname?"/"!==o.pathname.charAt(0)&&(o.pathname=resolvePathname(o.pathname,a.pathname)):o.pathname=a.pathname:o.pathname||(o.pathname="/"),o}function locationsAreEqual(n,t){return n.pathname===t.pathname&&n.search===t.search&&n.hash===t.hash&&n.key===t.key&&valueEqual(n.state,t.state)}function createTransitionManager(){var o=null;var a=[];return{setPrompt:function(n){return o=n,function(){o===n&&(o=null)}},confirmTransitionTo:function(n,t,e,a){null!=o?"string"==typeof(t="function"==typeof o?o(n,t):o)?"function"==typeof e?e(t,a):a(!0):a(!1!==t):a(!0)},appendListener:function(n){var t=!0;function e(){t&&n.apply(void 0,arguments)}return a.push(e),function(){t=!1,a=a.filter(function(n){return n!==e})}},notifyListeners:function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];a.forEach(function(n){return n.apply(void 0,t)})}}}var canUseDOM=!("undefined"==typeof window||!window.document||!window.document.createElement);function getConfirmation(n,t){t(window.confirm(n))}function supportsHistory(){var n=window.navigator.userAgent;return(-1===n.indexOf("Android 2.")&&-1===n.indexOf("Android 4.0")||-1===n.indexOf("Mobile Safari")||-1!==n.indexOf("Chrome")||-1!==n.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}function supportsPopStateOnHashChange(){return-1===window.navigator.userAgent.indexOf("Trident")}function supportsGoWithoutReloadUsingHash(){return-1===window.navigator.userAgent.indexOf("Firefox")}function isExtraneousPopstateEvent(n){return!!n.state.turbolinks||void 0===n.state&&-1===navigator.userAgent.indexOf("CriOS")}var PopStateEvent="popstate",HashChangeEvent="hashchange";function getHistoryState(){try{return window.history.state||{}}catch(n){return{}}}function createBrowserHistory(n){void 0===n&&(n={}),canUseDOM||invariant(!1);var r=window.history,i=supportsHistory(),t=!supportsPopStateOnHashChange(),e=n.forceRefresh,c=void 0!==e&&e,e=n.getUserConfirmation,s=void 0===e?getConfirmation:e,e=n.keyLength,a=void 0===e?6:e,o=n.basename?stripTrailingSlash(addLeadingSlash(n.basename)):"";function h(n){var t=n||{},e=t.key,n=t.state,t=window.location,t=t.pathname+t.search+t.hash;return createLocation(t=o?stripBasename(t,o):t,n,e)}function u(){return Math.random().toString(36).substr(2,a)}var f=createTransitionManager();function d(n){_extends(L,n),L.length=r.length,f.notifyListeners(L.location,L.action)}function l(n){isExtraneousPopstateEvent(n)||g(h(n.state))}function p(){g(h(getHistoryState()))}var v=!1;function g(t){v?(v=!1,d()):f.confirmTransitionTo(t,"POP",s,function(n){n?d({action:"POP",location:t}):function(n){var t=L.location,t=P.indexOf(t.key);-1===t&&(t=0);n=P.indexOf(n.key);-1===n&&(n=0);n=t-n;n&&(v=!0,w(n))}(t)})}var n=h(getHistoryState()),P=[n.key];function m(n){return o+createPath(n)}function w(n){r.go(n)}var y=0;function H(n){1===(y+=n)&&1===n?(window.addEventListener(PopStateEvent,l),t&&window.addEventListener(HashChangeEvent,p)):0===y&&(window.removeEventListener(PopStateEvent,l),t&&window.removeEventListener(HashChangeEvent,p))}var x=!1;var L={length:r.length,action:"POP",location:n,createHref:m,push:function(n,t){var a=createLocation(n,t,u(),L.location);f.confirmTransitionTo(a,"PUSH",s,function(n){var t,e;n&&(t=m(a),e=a.key,n=a.state,i?(r.pushState({key:e,state:n},null,t),c?window.location.href=t:(n=P.indexOf(L.location.key),(n=P.slice(0,-1===n?0:n+1)).push(a.key),P=n,d({action:"PUSH",location:a}))):window.location.href=t)})},replace:function(n,t){var a="REPLACE",o=createLocation(n,t,u(),L.location);f.confirmTransitionTo(o,a,s,function(n){var t,e;n&&(t=m(o),e=o.key,n=o.state,i?(r.replaceState({key:e,state:n},null,t),c?window.location.replace(t):(-1!==(n=P.indexOf(L.location.key))&&(P[n]=o.key),d({action:a,location:o}))):window.location.replace(t))})},go:w,goBack:function(){w(-1)},goForward:function(){w(1)},block:function(n){var t=f.setPrompt(n=void 0===n?!1:n);return x||(H(1),x=!0),function(){return x&&(x=!1,H(-1)),t()}},listen:function(n){var t=f.appendListener(n);return H(1),function(){H(-1),t()}}};return L}var HashChangeEvent$1="hashchange",HashPathCoders={hashbang:{encodePath:function(n){return"!"===n.charAt(0)?n:"!/"+stripLeadingSlash(n)},decodePath:function(n){return"!"===n.charAt(0)?n.substr(1):n}},noslash:{encodePath:stripLeadingSlash,decodePath:addLeadingSlash},slash:{encodePath:addLeadingSlash,decodePath:addLeadingSlash}};function getHashPath(){var n=window.location.href,t=n.indexOf("#");return-1===t?"":n.substring(t+1)}function pushHashPath(n){window.location.hash=n}function replaceHashPath(n){var t=window.location.href.indexOf("#");window.location.replace(window.location.href.slice(0,0<=t?t:0)+"#"+n)}function createHashHistory(n){void 0===n&&(n={}),canUseDOM||invariant(!1);var t=window.history,e=(supportsGoWithoutReloadUsingHash(),n.getUserConfirmation),o=void 0===e?getConfirmation:e,e=n.hashType,e=void 0===e?"slash":e,r=n.basename?stripTrailingSlash(addLeadingSlash(n.basename)):"",n=HashPathCoders[e],i=n.encodePath,a=n.decodePath;function c(){var n=a(getHashPath());return createLocation(n=r?stripBasename(n,r):n)}var s=createTransitionManager();function h(n){_extends(m,n),m.length=t.length,s.notifyListeners(m.location,m.action)}var u=!1,f=null;function d(){var t,n=getHashPath(),e=i(n);n!==e?replaceHashPath(e):(n=c(),e=m.location,!u&&locationsAreEqual(e,n)||f!==createPath(n)&&(f=null,t=n,u?(u=!1,h()):s.confirmTransitionTo(t,"POP",o,function(n){n?h({action:"POP",location:t}):function(n){var t=m.location,t=l.lastIndexOf(createPath(t));-1===t&&(t=0);n=l.lastIndexOf(createPath(n));-1===n&&(n=0);n=t-n;n&&(u=!0,p(n))}(t)})))}e=getHashPath(),n=i(e);e!==n&&replaceHashPath(n);var n=c(),l=[createPath(n)];function p(n){t.go(n)}var v=0;function g(n){1===(v+=n)&&1===n?window.addEventListener(HashChangeEvent$1,d):0===v&&window.removeEventListener(HashChangeEvent$1,d)}var P=!1;var m={length:t.length,action:"POP",location:n,createHref:function(n){return"#"+i(r+createPath(n))},push:function(n,t){var e=createLocation(n,void 0,void 0,m.location);s.confirmTransitionTo(e,"PUSH",o,function(n){var t;n&&(t=createPath(e),n=i(r+t),getHashPath()!==n?(f=t,pushHashPath(n),n=l.lastIndexOf(createPath(m.location)),(n=l.slice(0,-1===n?0:n+1)).push(t),l=n,h({action:"PUSH",location:e})):h())})},replace:function(n,t){var e="REPLACE",a=createLocation(n,void 0,void 0,m.location);s.confirmTransitionTo(a,e,o,function(n){var t;n&&(t=createPath(a),n=i(r+t),getHashPath()!==n&&(f=t,replaceHashPath(n)),-1!==(n=l.indexOf(createPath(m.location)))&&(l[n]=t),h({action:e,location:a}))})},go:p,goBack:function(){p(-1)},goForward:function(){p(1)},block:function(n){var t=s.setPrompt(n=void 0===n?!1:n);return P||(g(1),P=!0),function(){return P&&(P=!1,g(-1)),t()}},listen:function(n){var t=s.appendListener(n);return g(1),function(){g(-1),t()}}};return m}function clamp(n,t,e){return Math.min(Math.max(n,t),e)}function createMemoryHistory(n){var o=(n=void 0===n?{}:n).getUserConfirmation,t=n.initialEntries,e=void 0===t?["/"]:t,t=n.initialIndex,t=void 0===t?0:t,n=n.keyLength,a=void 0===n?6:n,r=createTransitionManager();function i(n){_extends(h,n),h.length=h.entries.length,r.notifyListeners(h.location,h.action)}function c(){return Math.random().toString(36).substr(2,a)}t=clamp(t,0,e.length-1),e=e.map(function(n){return createLocation(n,void 0,"string"!=typeof n&&n.key||c())});function s(n){var t=clamp(h.index+n,0,h.entries.length-1),e=h.entries[t];r.confirmTransitionTo(e,"POP",o,function(n){n?i({action:"POP",location:e,index:t}):i()})}var h={length:e.length,action:"POP",location:e[t],index:t,entries:e,createHref:createPath,push:function(n,t){var e=createLocation(n,t,c(),h.location);r.confirmTransitionTo(e,"PUSH",o,function(n){var t;n&&(t=h.index+1,(n=h.entries.slice(0)).length>t?n.splice(t,n.length-t,e):n.push(e),i({action:"PUSH",location:e,index:t,entries:n}))})},replace:function(n,t){var e="REPLACE",a=createLocation(n,t,c(),h.location);r.confirmTransitionTo(a,e,o,function(n){n&&(h.entries[h.index]=a,i({action:e,location:a}))})},go:s,goBack:function(){s(-1)},goForward:function(){s(1)},canGo:function(n){return 0<=(n=h.index+n)&&n<h.entries.length},block:function(n){return r.setPrompt(n=void 0===n?!1:n)},listen:function(n){return r.appendListener(n)}};return h}exports.createBrowserHistory=createBrowserHistory,exports.createHashHistory=createHashHistory,exports.createMemoryHistory=createMemoryHistory,exports.createLocation=createLocation,exports.locationsAreEqual=locationsAreEqual,exports.parsePath=parsePath,exports.createPath=createPath;
